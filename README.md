# gRPC Chat Service

Этот проект представляет собой gRPC-сервис для общения в чатах. Он состоит из трех компонентов:

- **Auth Service** – сервис аутентификации пользователей через JWT.
- **Chat Service** – сервис управления чатами и сообщениями.
- **CLI-клиент** – терминальный интерфейс для взаимодействия с сервисами.

## Функционал

### Auth Service:
* Регистрация и авторизация пользователей.
* Выдача `access_token` и `refresh_token`.
* Проверка прав доступа к методам чата.

### Chat Service:
* Создание и удаление чатов.
* Отправка сообщений и их сохранение в базе данных.
* Подключение к чату с загрузкой истории и стримингом новых сообщений.

## Технологии

* **Go** – язык программирования.
* **gRPC** – для обмена данными между сервисами.
* **PostgreSQL** – база данных для хранения пользователей и сообщений.
* **bcrypt** – хеширование паролей.
* **JWT** – авторизация через токены.
* **zap** – логирование.
* **Docker & Docker Compose** – контейнеризация и оркестрация сервисов.

## Запуск проекта

### 1. Клонирование репозитория

```sh
git clone git@github.com:femstuff/chat-grpc.git
cd chat-grpc
```

### 2. Сборка и запуск контейнеров

```sh
make build  # Сборка Docker-образов
make up     # Запуск контейнеров в фоновом режиме
```

### 3. Применение миграций (создание таблиц)

```sh
make migrate-up
```

> **Примечание:** Если возникают ошибки при применении миграций, выполните:
>
> ```sh
> make install-migrate
> ```

### 4. Запуск сервисов вручную (если необходимо)

```sh
make auth  # Запуск только auth-service
make chat  # Запуск только chat-service
```

### 5. Запуск CLI-клиента

```sh
make cli
```

## Использование CLI

### Доступные команды:

```sh
login <username> <password>         # Войти в систему  
create_chat <user1,user2,...>        # Создать чат  
send_message <chat_id> <from> <text> # Отправить сообщение  
connect <chat_id>                    # Подключиться к чату  
exit                                  # Выйти
```

### Пример работы:

```sh
> login user1 password123
Успешный вход!

> create_chat user1,user2
Чат создан, ID: 10

> send_message 10 user1 "Привет, как дела?"
Сообщение отправлено

> connect 10
[12:30] user1: Привет, как дела?
```

## Остановка и очистка проекта

### Остановка контейнеров

```sh
make down
```

### Полная очистка контейнеров, образов и томов

```sh
make clean
```